(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[489],{84679:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/confirm-configuration",function(){return t(71075)}])},71075:function(e,s,t){"use strict";t.r(s);var a=t(85893),r=t(67294),i=t(2543),n=t(64146),l=t(96497),o=t(33147),c=t(84496),d=t(87536),h=t(35292),u=t(30272),p=t(31431),x=t(11163),g=t(59600),m=t(70521),f=t(69671),v=t(46601),j=t(26618),y=t(54579),w=t(55424);let ConfirmConfiguration=()=>{let e,s;let{provider:t}=(0,h.kR)(),{address:S,chainId:C}=(0,w.m)(),{handleSubmit:_}=(0,d.cI)({mode:"onChange"}),A=(0,x.useRouter)(),[b,k]=(0,r.useState)(),[R,E]=(0,r.useState)(),[$,N]=(0,r.useState)(!1),[O,I]=(0,r.useState)(""),[D,T]=(0,r.useState)(),[W,H]=(0,r.useState)(),[F,K]=(0,r.useState)(!1),[z,M]=(0,r.useState)(""),P="v1.7.0",[Z,J]=(0,r.useState)(!1),[L,U]=(0,r.useState)(""),[X,Y]=(0,r.useState)(""),Q=(0,c.o)(e=>e.clusterDefinition),V=(null==Q?void 0:Q.principal)&&!(null==Q?void 0:Q.singleAddress)&&(null==Q?void 0:Q.recipients.every(e=>(0,u.H6)(e))),q=!(null==Q?void 0:Q.principal)&&!(null==Q?void 0:Q.singleAddress)&&(null==Q?void 0:Q.recipients.every(e=>(0,u.H6)(e))),B=!(null==Q?void 0:Q.principal)&&(null==Q?void 0:Q.singleAddress)&&!(null==Q?void 0:Q.recipients.every(e=>(0,u.H6)(e)));V?(e="Rewards",s="Deploy Obol Splits"):q&&(e="Principal & Rewards",s="Deploy 'Split Everything' Contract");let G=null==Q?void 0:Q.operators.some(e=>e.address===S),ee=(0,c.o)(e=>e.updateClusterDefinition),es=(0,c.o)(e=>e.completeLeaderStep),et=(0,c.o)(e=>e.enableLeaderStep),clearState=()=>{k(null),E(null),I(""),T(""),H(""),N(!1)},catchError=e=>{console.log(e),clearState()},postCall=async e=>{let s=await (0,p.c0)({token:e,data:b});if(!s.data.config_hash)throw"no config hash returned";I(s.data.config_hash)};(0,r.useEffect)(()=>{if(b){let createConfig=async()=>{try{let e={creator_config_hash:b.config_hash},s=await (0,u.L6)(t,C,S,e);if(await postCall(s),G){let e={operator_config_hash:b.config_hash},s=await (0,u.AM)(t,C,S,e);H(s);let a={enr:null==Q?void 0:Q.enr},r=await (0,u.Ol)(t,C,S,a);T(r)}}catch(e){catchError(e)}};createConfig()}},[b]),(0,r.useEffect)(()=>{if(G&&R&&O||!G&&O){es("confirm-configuration");let e=et("invite-group");N(!1),A.push({pathname:e.href,query:{configHash:O}})}},[R,O]),(0,r.useEffect)(()=>{if(G&&D&&W&&O){let putCall=async()=>{let e={address:S,enr:null==Q?void 0:Q.enr,enr_signature:D,fork_version:o.se,version:P},{data:s}=await (0,p.R)({token:W,data:e,configHash:O});E(s)};putCall().catch(catchError)}},[D,O]);let OperatorsStatusSection=()=>(0,a.jsx)(l.W2,{className:"cluster-details",alignItems:"start",children:(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,a.jsx)(j.uo,{}),(0,a.jsx)(i.VL,{operators:[...null==Q?void 0:Q.operators],currentAccount:S})]})}),ENRSection=()=>(0,a.jsxs)(l.W2,{className:"enr-section",alignItems:"start",css:{gap:"$lg"},children:[(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$sm"},children:[(0,a.jsxs)(l.kC,{css:{alignItems:"center",gap:"$xxxs"},children:[(0,a.jsx)(l.xv,{variant:"subline",color:"body",css:{textTransform:"uppercase"},children:"Your Charon client ENR"}),(0,a.jsx)(l.KZ,{content:'An ENR is an "Ethereum Node Record" used to identify your client to the other clients in the cluster"',children:(0,a.jsx)(l.xu,{css:{display:"flex"},children:(0,a.jsx)(l.by,{})})})]}),(0,a.jsx)(i.Kx,{css:{minHeight:"115px"},placeholder:"Your enr",value:null==Q?void 0:Q.enr,readOnly:!0})]}),(0,a.jsxs)(l.rU,{href:"https://docs.obol.tech/docs/start/quickstart_group#step-1-generate-an-enr",target:"_blank",children:["More on Ethereum Node Records ",(0,a.jsx)(l.ZJ,{})]})]}),deploySplitterContract=async e=>{let{recipientsAddresses:s,splitPercentages:t,splitMainContract:a}=e;try{let e=await (0,v.s8)(s,t,a);console.log("realSplitAddress",e),ee({...Q,validators:Array(Q.validatorsSize).fill({feeRecipientAddress:e,withdrawalAddress:e})}),M(e);return}catch(s){let e=(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)?(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)[0]:null==s?void 0:s.message;throw console.log(e,"errorMessage"),U(e),s}},deployMultiCallContract=async e=>{let{recipientsAddresses:s,splitPercentages:a,predictedSplitAddress:r}=e;try{let{owrAddress:e,splitAddress:i}=await (0,v.KZ)({principalRecipient:Q.principal,amountOfPrincipalStake:32*Q.validatorsSize},{accounts:s,percentAllocations:a},r,t.getSigner(0));ee({...Q,validators:Array(Q.validatorsSize).fill({feeRecipientAddress:i,withdrawalAddress:e})}),M(i);return}catch(s){let e=(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)?(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)[0]:null==s?void 0:s.message;throw U(e),s}},deployOWRFactoryContract=async e=>{try{let s=await (0,v.Sf)(Q.principal,e,32*Q.validatorsSize,t.getSigner(0));console.log(s,"OWRecipientContractAddresses"),ee({...Q,validators:Array(Q.validatorsSize).fill({feeRecipientAddress:e,withdrawalAddress:s})}),M(e);return}catch(s){let e=(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)?(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)[0]:null==s?void 0:s.message;throw U(e),s}},handleOnDeploySplitter=async e=>{if(e.preventDefault(),!F){U(""),K(!0);try{let e=await (0,u.jT)(o.nU,t),s=await (0,u.jT)(o.wi,t),a=await (0,u.jT)(o.eh,t);if(!e||!s||!a){U(o.dK),K(!1);return}let r=[...Q.recipients];r.sort((e,s)=>e.address.localeCompare(s.address));let i=r.map(e=>e.address),l=r.map(e=>{let s=(1e4*parseFloat(e.split)).toFixed(0);return parseInt(s)}),c=new n.CH(o.wi,f.s,null==t?void 0:t.getSigner(0)),d=await c.predictImmutableSplitAddress(i,l,o.Uu);console.log("predictedSplitAddress",d);let h=await (0,v.Kv)(d,C);console.log(h,"isSplitterDeployed"),V?h?(await deployOWRFactoryContract(d),Y(o.Oy)):await deployMultiCallContract({recipientsAddresses:i,splitPercentages:l,predictedSplitAddress:d}):q&&(h?(ee({...Q,validators:Array(Q.validatorsSize).fill({feeRecipientAddress:d,withdrawalAddress:d})}),M(d),Y(o.Oy)):await deploySplitterContract({recipientsAddresses:i,splitPercentages:l,splitMainContract:c})),K(!1)}catch(e){console.error(e),K(!1),Y(e.message)}}},ea=(0,r.useMemo)(()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(OperatorsStatusSection,{}),(0,a.jsx)(j.XD,{}),G&&(0,a.jsx)(ENRSection,{}),(0,a.jsxs)(l.W2,{className:"withdrawal-section",css:{gap:"$xl"},alignItems:"start",children:[(0,a.jsx)(l.xv,{variant:"h4",children:"Withdrawal Configuration"}),"Rewards"===e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.nB,{heading:"Withdrawal Address",description:"Address to receive skimming rewards and validator principal at exit.",value:null==Q?void 0:Q.principal,className:"principal-address-section"}),(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$xs"},children:[(0,a.jsxs)(l.xv,{variant:"h5",children:[e," Split"]}),(0,a.jsx)(l.xv,{color:"body",variant:"body",children:"Explainer of what these are"}),(0,a.jsx)(g.I,{recipients:Q.recipients,type:e})]}),z&&(0,a.jsxs)(l.W2,{variant:"card",className:"enr-section",alignItems:"start",css:{gap:"$sm",p:"$sm"},children:[(0,a.jsxs)(l.kC,{css:{gap:"$sm"},children:[(0,a.jsx)(l.xu,{children:(0,a.jsx)(l.nQ,{})}),(0,a.jsx)(l.xu,{css:{display:"flex",fd:"column",gap:"$xs"},children:(0,a.jsx)(l.xv,{variant:"body",css:{color:"white"},children:"Optimistic Withdrawal Recipient Contract Successfully Deployed"})})]}),(0,a.jsx)(l.xv,{color:"body",variant:"subline",css:{lineHeight:"$lg",textTransform:"uppercase",letterSpacing:"1px"},children:"Optimistic Withdrawal Recipient Contract Address"}),(0,a.jsx)(l.IK,{readOnly:!0,value:Q.validators[0].withdrawalAddress}),(0,a.jsxs)(l.rU,{href:"https://".concat(o.pn,".etherscan.io/address/").concat(Q.validators[0].withdrawalAddress,"#code"),target:"_blank",children:["View on Etherscan ",(0,a.jsx)(l.ZJ,{})]})]})]}),"Principal & Rewards"===e&&(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$xs"},children:[(0,a.jsxs)(l.xv,{variant:"h5",children:[e," Split"]}),(0,a.jsx)(l.xv,{color:"body",variant:"body",children:"Explainer of what these are"}),(0,a.jsx)(g.I,{recipients:Q.recipients,type:e,validatorsSize:Q.validators.length})]}),z&&(0,a.jsxs)(l.W2,{variant:"card",className:"enr-section",alignItems:"start",css:{gap:"$sm",p:"$sm"},children:[(0,a.jsxs)(l.kC,{css:{gap:"$sm"},children:[(0,a.jsx)(l.xu,{children:(0,a.jsx)(l.nQ,{})}),(0,a.jsx)(l.xu,{css:{display:"flex",fd:"column",gap:"$xs"},children:(0,a.jsx)(l.xv,{variant:"body",css:{color:"white"},children:"Splitter Contract Successfully Deployed"})})]}),(0,a.jsx)(l.xv,{color:"body",variant:"subline",css:{lineHeight:"$lg",textTransform:"uppercase",letterSpacing:"1px"},children:"Splitter Contract Address"}),(0,a.jsx)(l.IK,{readOnly:!0,value:z}),(0,a.jsxs)(l.rU,{href:"https://".concat(o.pn,".etherscan.io/address/").concat(z,"#code"),target:"_blank",children:["View on Etherscan ",(0,a.jsx)(l.ZJ,{})]})]}),!z&&(0,a.jsx)(i.fl,{color:"primary",type:"button",onClick:handleOnDeploySplitter,children:(0,a.jsxs)(a.Fragment,{children:[F&&(0,a.jsx)(l.yC,{}),s]})}),X&&(0,a.jsx)(l.xv,{variant:"metadata",color:"testHover",children:X}),L&&(0,a.jsx)(l.xv,{variant:"metadata",color:"test",children:L})]})]}),[z,F,L,Q]),er=(0,r.useMemo)(()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(OperatorsStatusSection,{}),(0,a.jsx)(j.XD,{}),G&&(0,a.jsx)(ENRSection,{}),(0,a.jsx)(y.EJ,{singleAddress:null==Q?void 0:Q.singleAddress,feeRecipientAddress:null==Q?void 0:Q.feeRecipientAddress})]}),[Q]);if(!Q)return(0,a.jsx)(l.xv,{children:"No cluster data ..."});let onSubmit=async()=>{if($)return;console.log(JSON.stringify(Q),"currentClusterData");let e=(0,u.KH)(Q,P);console.log(e.config_hash,"config_hashconfig_hash"),k(e),N(!0)};return(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,a.jsx)(l.xv,{variant:"h3",children:"Confirm Configuration"}),(0,a.jsx)(i.l0,{onSubmit:_(onSubmit),children:(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,a.jsx)(m.T,{name:"reward_split_withdrawal_flow",children:V&&ea}),(0,a.jsx)(m.T,{name:"split_withdrawal_flow",children:q&&ea}),(0,a.jsx)(m.T,{name:"single_withdrawal_address_flow",children:B&&er}),(0,a.jsx)(l.kC,{direction:"column",css:{gap:"$lg"},children:(0,a.jsxs)(l.W2,{className:"enr-section",alignItems:"start",css:{gap:"$lg"},children:[(0,a.jsx)(l.kC,{direction:"column",css:{gap:"$xs"},children:(0,a.jsx)(l.xv,{variant:"h4",children:"Confirm Details "})}),(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$xl"},children:[(0,a.jsxs)(l.kC,{css:{gap:"$xs",width:"$full"},children:[(0,a.jsx)(l.xu,{children:(0,a.jsx)(l.XZ,{checked:Z,onCheckedChange:()=>J(!Z)})}),(0,a.jsx)(l.xv,{variant:"body",children:"You will be prompted to sign a message with your wallet. This signature is attesting to the fact that:"})]}),(0,a.jsx)(l.sQ,{heading:"You have confirmed the withdrawal address for the validators to be created is correct. If this address is a contract, you have confirmed the contract implementation is correct. If this address is an externally-owned account, you have confirmed that the EOA custody is secure."}),(0,a.jsx)(l.sQ,{heading:"You have submitted your charon node's Ethereum Node Record (ENR) correctly. This signature is the authorisation of this charon client to act on your behalf."})]}),(0,a.jsx)(i.fl,{color:"primary",type:"submit",disabled:!B&&!z||!Z,children:(0,a.jsxs)(a.Fragment,{children:[$&&(0,a.jsx)(l.yC,{}),"Confirm and Sign"]})})]})})]})})]})};s.default=ConfirmConfiguration,ConfirmConfiguration.layout="ProgressTrackerLayout"}},function(e){e.O(0,[774,888,179],function(){return e(e.s=84679)}),_N_E=e.O()}]);