(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[205],{50068:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/clusters/details",function(){return s(22439)}])},32890:function(e,t,s){"use strict";s.d(t,{X:function(){return ErrorPageContainer}});var i=s(85893);s(67294);var a=s(96497);let ErrorPageContainer=e=>{let{children:t,css:s={}}=e;return(0,i.jsxs)(a.W2,{css:{borderRadius:0,marginTop:"$7xl",...s},children:[(0,i.jsx)(a.xv,{variant:"h4",children:"Error \uD83D\uDE25"}),(0,i.jsx)(a.xv,{variant:"body",children:t})]})}},22439:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return details}});var i=s(85893),a=s(96497),n=s(11163),l=s.n(n),r=s(35292),o=s(30272);let d=(0,a.zo)(a.kC,{flexDirection:"column",width:"auto",gap:"$2xl",px:"10%",py:"$5xl","@sm":{px:"10%",pb:"$5xl",pt:"$xl"}});var c=s(33147),u=s(55424),x=s(67294),h=s(13559),p=s(46601),v=s(9279),f=s(81794),g=s(64146),m=s(35553);async function getOWRMetadata(e,t){let s=e.getSigner(),i=new g.CH(t,f.i.abi,s),a=await i.getTranches(),n=await i.fundsPendingWithdrawal(),l=await i.claimedPrincipalFunds(),r=parseFloat(m.formatEther(n)),o=parseFloat(m.formatEther(l)),d={principalRecipient:a.principalRecipient,rewardRecipient:a.rewardRecipient,amountOfPrincipalStake:parseFloat(m.formatEther(a.amountOfPrincipalStake)),claimedPrincipalFunds:o,fundsPendingWithdrawal:r};return d}let claim=async(e,t,s,i,a,n)=>{try{let n;return n=e===t?await (0,p.Vx)(s,i,a.getSigner(0),p.Ap):await (0,p.E4)(s,e,i,a.getSigner(0),p.Ap),{loading:!1,txHash:n,completed:!0}}catch(e){return{loading:!1,errorMessage:e.message}}},getWithdrawalBalance=async(e,t)=>{let s=await (null==e?void 0:e.getBalance(t));return(0,p.lM)(null==s?void 0:s._hex)},getBalance=async(e,t,s,i,a,n,l)=>{let r="0",d="0",c=!1,u=await (0,p.xi)(t,l),x=null==u?void 0:u.activeBalances[v.d];x&&(d=(0,o.A4)(x));let h=null==e?void 0:e.percentAllocations[null==e?void 0:e.accounts.indexOf(t)],f=Number(s)*(1e-4*Number(h)/100);if(t&&e.accounts&&e.percentAllocations&&i){if(a===e.split)r=(f+parseFloat(d)).toString();else{let l=await getOWRMetadata(n,a),d=await (0,o.y2)(t,a,e,i,o.kx);if(Number(s)>=16&&l.principalRecipient===t){c=!0;let e=Math.max(0,l.amountOfPrincipalStake-l.claimedPrincipalFunds),t=Math.max(0,Number(s)-l.fundsPendingWithdrawal);r=(Number(d)+Math.min(e,t)).toString()}else r=Number(d).toString()}}return{balance:r,isPrincipal:c}},ExitButton=e=>{let{disabled:t,onClick:s}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.xv,{variant:"body",children:"Exit all validators in this cluster."}),(0,i.jsx)(a.xv,{variant:"body",children:"This cluster will no longer earn rewards."}),(0,i.jsx)(a.xv,{variant:"body",children:"Upon exiting the cluster you will be able to withdraw the original principal & claim all rewards."}),(0,i.jsx)(a.zx,{color:"primary",type:"button",css:{width:"auto"},disabled:t,onClick:s,children:"Exit Cluster"})]})},TransactionSection=e=>{let{icon:t,heading:s,children:n}=e;return(0,i.jsxs)(a.mh,{children:[(0,i.jsxs)(a.xu,{children:["successfully"===t&&(0,i.jsx)(a.nQ,{}),"loading"===t&&(0,i.jsx)(a.ZG,{}),"exiting"===t&&(0,i.jsx)(a.lR,{})]}),(0,i.jsx)(a.xu,{css:{display:"flex",fd:"column",gap:"$sm"},children:(0,i.jsxs)(a.xu,{css:{display:"flex",fd:"column",gap:"$xs"},children:[(0,i.jsx)(a.xv,{variant:"body",css:{color:"white"},children:s}),n]})})]})},ExitLoading=e=>{let{txHash:t}=e;return(0,i.jsxs)(TransactionSection,{icon:"exiting",heading:"Cluster is exiting",children:[(0,i.jsxs)(a.rU,{css:{fontSize:"$4",fontWeight:"$normal"},target:"_blank",href:"https://".concat(c.pn,".beaconchain.io/tx/").concat(t),children:["Check Status on Beaconchain",(0,i.jsx)(a._j,{size:"sm"})]}),(0,i.jsxs)(a.rU,{css:{fontSize:"$4",fontWeight:"$normal"},target:"_blank",href:"https://docs.obol.tech/docs/start/quickstart-exit",children:["Learn More",(0,i.jsx)(a.ZJ,{size:"sm"})]})]})},SuccessfullyExited=()=>(0,i.jsxs)(a.kC,{direction:"column",css:{gap:"$sm"},children:[(0,i.jsx)(TransactionSection,{icon:"successfully",heading:"Cluster is successfully exited"}),(0,i.jsx)(a.xv,{variant:"body",children:"Calling Waterfall Funds pushes the principal ETH to the Withdrawal Address and accrued rewards to the splitter contract."})]}),SectionTitle=e=>{let{children:t}=e;return(0,i.jsx)(a.kC,{direction:"column",children:(0,i.jsx)(a.xv,{variant:"h4",children:t})})},j={gap:"$lg",alignItems:"flex-start",justifyContent:"flex-start",gridColumn:"span 1"},ExitClusterSection=e=>{let{clusterStatus:t,handleOnExit:s,txHash:n}=e;return(0,i.jsxs)(a.W2,{css:j,children:[(0,i.jsx)(SectionTitle,{children:"Exit Cluster"}),"exiting"===t?(0,i.jsx)(ExitLoading,{txHash:n}):"exited"===t?(0,i.jsx)(SuccessfullyExited,{}):(0,i.jsx)(ExitButton,{disabled:"active"!==t,onClick:()=>s()})]})};var w=s(2543),C=s(19485);let ClaimButton=e=>{let{splitRecipients:t,claimData:s,onClick:n}=e,{account:l}=(0,r.kR)(),{isPrincipalConnected:o,error:d,claimStatus:c,balance:u}=s,x=!(0,C.isAddress)(l)||!!d||!u||u&&0===parseFloat(u)||(null==c?void 0:c.completed)||!(null==t?void 0:t.some(e=>e.recipient.address.toLowerCase()===(null==l?void 0:l.toLowerCase())))&&!o;return(0,i.jsx)(w.fl,{variant:(null==c?void 0:c.loading)?"tx":void 0,color:"primary",type:"button",css:{width:"auto"},disabled:x,onClick:n,fullWidth:!0,children:(null==c?void 0:c.loading)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.yC,{}),"Transaction in progress"]}):(0,i.jsx)(i.Fragment,{children:" Claim ETH"})})},Balance=e=>{let{balance:t}=e;return(0,i.jsxs)(a.kC,{css:{gap:"$xxs",alignItems:"center"},children:[(0,i.jsx)(a.Ee,{src:"/assets/eth-icon.png",alt:"eth",width:24,height:24}),(0,i.jsx)(a.xv,{css:{textTransform:"uppercase"},variant:"h5",children:parseFloat(t).toFixed(2)||"0.00"})]})},LabelWithTooltip=e=>{let{children:t}=e;return(0,i.jsxs)(a.kC,{css:{alignItems:"center",gap:"$xxxs"},children:[(0,i.jsx)(a.xv,{css:{textTransform:"uppercase"},variant:"subline",color:"body",children:t}),(0,i.jsx)(a.KZ,{content:"Your total amount of ETH claimable from the split",children:(0,i.jsx)(a.xu,{css:{display:"flex"},children:(0,i.jsx)(a.by,{})})})]})},SuccessfullyClaimed=e=>{let{txHash:t}=e;return(0,i.jsx)(TransactionSection,{icon:"successfully",heading:"Successfully claimed ETH",children:(0,i.jsxs)(a.rU,{css:{fontSize:"$4",fontWeight:"$normal"},target:"_blank",href:"https://".concat(c.pn,".etherscan.io/tx/").concat(t),children:["View on Etherscan",(0,i.jsx)(a._j,{size:"sm"})]})})},y={gap:"$lg",alignItems:"flex-start",justifyContent:"flex-start",gridColumn:"span 1"},ClaimEthSection=e=>{let{claimData:t,splitRecipients:s}=e,{account:n}=(0,r.kR)(),{isPrincipalConnected:l,claimStatus:o,balance:d,txHash:c,onClaim:u}=t,x=null==s?void 0:s.some(e=>{var t;return(null===(t=e.recipient.address)||void 0===t?void 0:t.toLowerCase())===(null==n?void 0:n.toLowerCase())});return(0,w.cr)("showClaimSection")&&(x||l||(null==o?void 0:o.completed)&&o.txHash)?(0,i.jsxs)(a.W2,{css:y,children:[(0,i.jsx)(SectionTitle,{children:"Claim ETH"}),(0,i.jsx)(LabelWithTooltip,{children:"Claimable"}),(0,i.jsx)(Balance,{balance:parseFloat(d).toFixed(2)||"0.00"}),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ClaimButton,{splitRecipients:s,claimData:t,onClick:u}),(null==o?void 0:o.completed)&&(0,i.jsx)(SuccessfullyClaimed,{txHash:c}),!x&&!l&&(0,i.jsx)(a.xv,{variant:"metadata",color:"test",children:"You are not a recipient of this split and cannot claim"})]})]}):null};var b=s(30120);let ClusterName=e=>{let{clusterDefinition:t}=e;return(0,i.jsxs)(a.kC,{direction:"column",css:{gap:"$xxs"},children:[(0,i.jsx)(a.xv,{variant:"h3",children:null==t?void 0:t.name}),(0,i.jsx)(a.xv,{variant:"metadata",color:"body",children:"Created ".concat(b.ou.fromISO(null==t?void 0:t.timestamp).toRelativeCalendar()," on ").concat(b.ou.fromISO(null==t?void 0:t.timestamp).toFormat("yyyy LLL dd"))})]})},ClusterInfoCards=e=>{let{clusterStatus:t,operatorsCount:s,validatorsCount:n}=e;return(0,i.jsxs)(a.kC,{css:{gap:"$lg","@sm":{flexDirection:"column"}},children:[t?(0,i.jsx)(a.gK,{heading:"Cluster Status",status:t,tooltipContent:"The cluster aggregate status"}):(0,i.jsx)(a.gK,{heading:"Cluster Status",content:"Loading...",tooltipContent:"The cluster aggregate status"}),(0,i.jsx)(a.gK,{heading:"Operators",content:s||"0",tooltipContent:"The number of cluster operators"}),(0,i.jsx)(a.gK,{heading:"Validators",content:n||"0",tooltipContent:"The number of cluster validators"})]})};var S=s(60480);let OperatorsSection=e=>{var t;let{clusterDefinition:s,currentAccount:n}=e;return(0,i.jsx)(i.Fragment,{children:(null==s?void 0:null===(t=s.operators)||void 0===t?void 0:t.length)>0&&((null==s?void 0:s.operators.find(e=>{let{address:t}=e;return!(0,S.U)(t)}))?(0,i.jsx)(a.sQ,{heading:"This cluster was not created using a Distributed Key Generation ceremony, and a single entity likely controls the validator private key(s)"}):(0,i.jsx)(w.Dq,{operators:s.operators,currentAccount:n,creatorAddress:s.creator.address}))})};var _=s(71993),k=s(33047);let E=[{accessorKey:"address",header:"Address"},{accessorKey:"status",header:"Status",sortable:!0},{accessorKey:"effectivenessDisplay",header:(0,i.jsxs)(a.kC,{css:{alignItems:"center",gap:"$xxs"},children:["Effectiveness",(0,i.jsx)(k.M,{content:"This score indicates the overall effectiveness of the Ethereum staking validator, gauging its performance based on the inclusion of attestations over its entire operational period."})]}),sortable:!0,sortAccessor:e=>e.effectiveness},{accessorKey:"withdrawalAddress",header:"Withdrawal Address"},{accessorKey:"feeRecipient",header:"Fee Recipient"}],ValidatorsTable=e=>{let{validators:t,currentAccount:s}=e;return(0,i.jsx)(w.g_,{css:{".table-container":{"@sm":{width:"900px"}}},children:(0,i.jsx)(a.Nk,{tabs:[{title:"Validators",tableProps:{columns:E,rows:t.map((e,t)=>({address:(0,i.jsxs)(a.xu,{css:{display:"flex",alignItems:"center",justifyContent:"start"},children:[(0,i.jsx)(a.dh,{value:(0,o.zN)(e.address,[0,6],5),readOnly:!0,css:{mr:"$xxs",color:"$obolGreen",width:"120px !important"}}),(0,i.jsx)(_.j,{link:"".concat(c.q2,"/validator/").concat(e.address)})]}),status:e.status||"Pending",effectiveness:e.effectiveness,effectivenessDisplay:e.effectivenessDisplay,withdrawalAddress:(0,o.qF)(s,e.withdrawalAddress)?(0,i.jsx)(w.Ze,{address:e.withdrawalAddress}):(0,i.jsx)(w.Ns,{address:e.withdrawalAddress}),feeRecipient:(0,o.qF)(s,e.feeRecipient)?(0,i.jsx)(w.Ze,{address:e.feeRecipient}):(0,i.jsx)(w.Ns,{address:e.feeRecipient})}))}}]})})},ValidatorsSection=e=>{let{clusterDefinition:t,validators:s}=e;return(0,i.jsx)(i.Fragment,{children:(null==s?void 0:s.length)>0?(0,i.jsx)(ValidatorsTable,{validators:s.map((e,t)=>({id:t.toString(),...e}))}):(0,i.jsxs)(a.W2,{css:{gap:"$lg",alignItems:"flex-start"},children:[(0,i.jsx)(a.sQ,{heading:"Distributed Key Generation is incomplete"}),(0,i.jsx)(a.zx,{as:"a",href:"/dv?configHash=".concat(t.config_hash),target:"_blank",children:"Complete DKG"})]})})};var T=s(54579);let SplitsAndPrincipalSection=e=>{let{splitRecipients:t,feeRecipientAddress:s,owrAddressOrSplitter:n,validatorsCount:l,splitMetadataLoading:r}=e,{address:o}=(0,u.m)();return(0,i.jsx)(i.Fragment,{children:(0,w.cr)("showSplitRewardTable")&&(null==t?void 0:t.length)>0&&o?(0,i.jsx)(T.pc,{recipients:t,validatorsSize:l,type:s===n?"Principal & Rewards":"Rewards"}):r&&(0,i.jsx)(a.xv,{variant:"subline",children:"Loading split table information..."})})},R={gap:"$lg","@sm":{flexDirection:"column",gap:"$md",alignItems:"flex-start",justifyContent:"flex-start",gridColumn:"span 2"}},ClusterDetailsContainer=e=>{var t,s,n,o;let{clusterDefinition:p,validators:v,currentAccount:f,clusterStatus:g}=e,{address:m}=(0,u.m)(),j=l().query.lockHash,C=(null==p?void 0:p.fee_recipient_address)||((null==p?void 0:p.validators)?null==p?void 0:null===(t=p.validators[0])||void 0===t?void 0:t.fee_recipient_address:null),y=(null==p?void 0:p.withdrawal_address)||((null==p?void 0:p.validators)?null==p?void 0:null===(s=p.validators[0])||void 0===s?void 0:s.withdrawal_address:null),{metadata:b,isLoading:S}=(0,r.DS)(C),_={accounts:null==b?void 0:b.recipientsSorted[0],percentAllocations:null==b?void 0:b.recipientsSorted[1],distributorFee:c.Uu,split:C},k=function(e,t,s){let[i,a]=(0,x.useState)("0"),[n,l]=(0,x.useState)("0"),[r,o]=(0,x.useState)(),[d,c]=(0,x.useState)(""),[u,p]=(0,x.useState)(null),[v,f]=(0,x.useState)(!1),{provider:g,chainId:m}=(0,h.Z)(),j=null==g?void 0:g.getSigner(0),w=(0,x.useCallback)(async()=>{let i={...r};o({...i,loading:!0});let a=await claim(s,t.split,e,t,g,n);o(i={...i,...a})},[r,s,g,t,e,n]);return(0,x.useEffect)(()=>{p(null);let fetchBalance=async()=>{try{let i=await getWithdrawalBalance(g,s);l(i);let{balance:n,isPrincipal:r}=await getBalance(t,e,i,j,s,g,m);a(n),f(r)}catch(e){f(!1),p(e)}};g&&s&&(null==t?void 0:t.split)&&fetchBalance()},[m,g,j,t,e,s,r]),(0,x.useEffect)(()=>{if(r){var e;let t="string"==typeof r.txHash?r.txHash:null===(e=r.txHash)||void 0===e?void 0:e.transactionHash;c(t)}},[r]),{txHash:d,claimStatus:r,balance:i,withdrawalBalance:n,isPrincipalConnected:v,error:u,onClaim:w}}(m,_,y),{isVerifiedSplitter:E}=(0,r.Gc)(C,y,32*p.num_validators);return(0,i.jsxs)(d,{children:[(0,i.jsx)(ClusterName,{clusterDefinition:p}),(0,i.jsx)(ClusterInfoCards,{clusterStatus:g,operatorsCount:null==p?void 0:null===(n=p.operators)||void 0===n?void 0:n.length,validatorsCount:null==v?void 0:v.length}),(0,i.jsx)(OperatorsSection,{clusterDefinition:p,currentAccount:f}),(0,i.jsx)(ValidatorsSection,{clusterDefinition:p,validators:v}),(null==b?void 0:null===(o=b.recipients)||void 0===o?void 0:o.length)>0&&!E&&(0,i.jsx)(w.fz,{content:c.p3}),(0,i.jsx)(SplitsAndPrincipalSection,{validatorsCount:null==v?void 0:v.length,splitRecipients:null==b?void 0:b.recipients,feeRecipientAddress:C,owrAddressOrSplitter:y,splitMetadataLoading:S}),(null==v?void 0:v.length)>0&&(0,i.jsxs)(a.kC,{css:R,children:[(0,i.jsx)(ExitClusterSection,{clusterStatus:g,handleOnExit:()=>{l().push({pathname:"/clusters/exit",query:{ctaRouteValue:j}})},txHash:k.txHash}),E&&(0,i.jsx)(ClaimEthSection,{claimData:k,splitRecipients:null==b?void 0:b.recipients})]})]})};var $=s(32890),details=()=>{var e,t,s,l;let c=(0,n.useRouter)(),{account:u}=(0,r.kR)(),x=(0,o.xs)(c,"lockHash"),{data:h,isLoading:p,error:v}=(0,r.sh)(x);if(x&&!h&&!p||!x||!p&&!h)return(0,i.jsx)($.X,{children:(null==v?void 0:null===(t=v.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Error: No details information provided, please double check the\n            link you followed or return to the home page."});if(v&&!h)return(0,i.jsx)($.X,{children:null==v?void 0:null===(l=v.response)||void 0===l?void 0:null===(s=l.data)||void 0===s?void 0:s.message});if(p)return(0,i.jsxs)(d,{children:[(0,i.jsx)(a.xv,{variant:"subline",children:"Loading cluster data..."}),";"]});let f=null==h?void 0:h.distributed_validators.map((e,t)=>({status:e.isLoadingValidatorStatus?(0,i.jsx)(a.xv,{children:"Loading ..."}):(0,i.jsx)(a.HV,{status:e.status,textVariant:"metricStatusCell"}),effectivenessDisplay:e.isLoadingValidatorEffectiveness?(0,i.jsx)(a.xv,{children:"Loading ..."}):e.effectiveness?(0,i.jsxs)(a.kC,{css:{gap:"$xs",alignItems:"center"},children:[(0,i.jsx)(a.RV,{}),(0,i.jsx)(a.xv,{variant:"metricStatusCell",css:{textTransform:"capitalize",color:"$obolGreen"},children:"".concat((100*e.effectiveness).toFixed(2)," %")})]}):"",effectiveness:e.effectiveness?(100*e.effectiveness).toFixed(2):"",address:e.distributed_public_key,withdrawalAddress:(null==h?void 0:h.cluster_definition.validators)?null==h?void 0:h.cluster_definition.validators[t].withdrawal_address:null==h?void 0:h.cluster_definition.withdrawal_address,feeRecipient:(null==h?void 0:h.cluster_definition.validators)?null==h?void 0:h.cluster_definition.validators[t].fee_recipient_address:null==h?void 0:h.cluster_definition.fee_recipient_address}));return(0,i.jsx)(ClusterDetailsContainer,{clusterDefinition:h.cluster_definition,validators:f,currentAccount:u,clusterStatus:h.distributed_validators.some(e=>e.isLoadingValidatorStatus)?null:(0,o.Uq)(h)})}}},function(e){e.O(0,[120,774,888,179],function(){return e(e.s=50068)}),_N_E=e.O()}]);