(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[915],{62367:function(e,s,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/config-cluster",function(){return i(40947)}])},40947:function(e,s,i){"use strict";i.r(s);var r=i(85893),t=i(67294),n=i(87536),l=i(96497),a=i(2543),d=i(27183),o=i(35292),c=i(84496),p=i(11163),u=i(33147),h=i(34695),v=i(30272),m=i(26618),g=i(70521);let ConfigCluster=()=>{var e,s,i,x,w,f;let j=(0,c.o)(e=>e.clusterDefinition),{control:b,register:C,handleSubmit:_,formState:{errors:A,isDirty:R,isValid:y},resetField:S,setValue:k,trigger:$,getValues:T}=(0,n.cI)({mode:"onChange",defaultValues:{operators:u.fI,recipients:u.tT,singleAddress:"",feeRecipientAddress:"",principal:"",enr:"",name:""}}),{fields:N,append:O,remove:E}=(0,n.Dq)({control:b,name:"operators"}),{fields:z,append:D,remove:Q}=(0,n.Dq)({control:b,name:"recipients"}),P=(0,p.useRouter)(),V=(0,c.o)(e=>e.completeLeaderStep),W=(0,c.o)(e=>e.enableLeaderStep),I=(0,c.o)(e=>e.updateClusterDefinition),[F,G]=(0,t.useState)(100),{account:L}=(0,o.kR)(),[q,H]=(0,t.useState)((null==j?void 0:j.clusterSize)||u.dd),J=(0,o.D9)(q),[M,B]=(0,t.useState)((null==j?void 0:j.validatorsSize)||1),[X,Z]=(0,t.useState)((0,g.c)("split_withdrawal_flow")&&(!(null==j?void 0:j.principal)&&!(null==j?void 0:j.singleAddress)&&(null==j?void 0:null===(e=j.recipients)||void 0===e?void 0:e.every(e=>(0,v.H6)(e)))||!(0,g.c)("single_withdrawal_address_flow")&&!(0,g.c)("reward_split_withdrawal_flow"))?"splitter":(0,g.c)("reward_split_withdrawal_flow")&&((null==j?void 0:j.principal)&&!(null==j?void 0:j.singleAddress)&&(null==j?void 0:null===(s=j.recipients)||void 0===s?void 0:s.every(e=>(0,v.H6)(e)))||!(0,g.c)("single_withdrawal_address_flow"))?"reward_splitter":"single"),[K,U]=(0,t.useState)(),handleOnAddRecipientRow=()=>{D({address:"",split:""})},handleOnRemoveRecipient=e=>{Q(e);let s=T().recipients.reduce((e,s)=>s.split?parseFloat(s.split)+e:e,0);G(s)},handleOnSetAccountAsOperator=e=>{e.preventDefault(),k("operators.0",{address:L}),$("operators.0")};return(0,t.useEffect)(()=>{X&&(S("singleAddress"),S("feeRecipientAddress"),S("principal"),S("recipients"),I({...j,validators:[]}))},[X]),(0,t.useEffect)(()=>{if(q){let e=(0,v.zT)(q);U(e)}J&&J<q&&O({address:""},{shouldFocus:!1}),J&&J>q&&E(q-1)},[J,q]),(0,t.useEffect)(()=>{k("singleAddress",null==j?void 0:j.singleAddress),k("feeRecipientAddress",null==j?void 0:j.feeRecipientAddress),k("enr",null==j?void 0:j.enr),k("name",null==j?void 0:j.name),k("principal",null==j?void 0:j.principal),(null==j?void 0:j.operators)&&k("operators",null==j?void 0:j.operators),(null==j?void 0:j.recipients)&&k("recipients",null==j?void 0:j.recipients)},[]),(0,r.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,r.jsx)(l.xv,{variant:"h3",children:"Configure Cluster"}),(0,r.jsx)(a.l0,{onSubmit:_(e=>{V("config-cluster"),I({...e,creator:{address:L},validatorsEthAmount:32*M,validators:Array(M).fill({feeRecipientAddress:e.feeRecipientAddress,withdrawalAddress:e.singleAddress})});let s=W("confirm-configuration");P.push(s.href)}),children:(0,r.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,r.jsx)(l.W2,{className:"cluster-details",alignItems:"start",children:(0,r.jsx)(m.PQ,{register:C,clusterSize:q,setClusterSize:H,control:b,min:u.dd})}),(0,r.jsxs)(l.W2,{className:"cluster-operators",alignItems:"start",children:[(0,r.jsx)(l.xv,{variant:"h4",children:"Node Operators"}),N.map((e,s)=>{var i,t,n;return(0,r.jsxs)(l.kC,{direction:"column",css:{gap:"$sm","& div > input":{color:"$obolGreen"}},children:[(0,r.jsxs)(l.kC,{direction:"column",css:{gap:"$sm"},children:[(0,r.jsxs)(l.kC,{css:{gap:"$sm",justifyContent:"space-between"},children:[(0,r.jsx)(l.xv,{variant:"subline",color:"body",css:{textTransform:"uppercase"},children:"Operator ".concat(s+1,"/").concat(q)}),0===s&&(0,r.jsx)(l.zx,{ghost:!0,css:{color:"$obolGreen",fontSize:"$1",p:0,height:"100%",textTransform:"uppercase"},onClick:handleOnSetAccountAsOperator,children:"use my address"})]}),(0,r.jsx)(d.bQ,{"data-testid":"Operator ".concat(s+1),control:b,trigger:$,name:"operators.".concat(s,".address"),items:T().operators,wrapperCSS:{border:"2px solid $bg04",backgroundColor:"$bg03",borderRadius:"$1",px:"$sm",py:"$xs","&:focus-within":{backgroundColor:"$bg02"}}})]}),(null===(i=A.operators)||void 0===i?void 0:i[s])&&(0,r.jsx)(l.xv,{variant:"metadata",color:"test",children:null===(n=A.operators)||void 0===n?void 0:null===(t=n[s].address)||void 0===t?void 0:t.message})]},":op".concat(e&&e.id,":"))})]}),(0,r.jsx)(m.J1,{control:b,contractType:X,validatorsSize:M,setValidatorsSize:B}),T().operators.some(e=>e.address===L)&&(0,r.jsxs)(l.W2,{className:"enr-section",alignItems:"start",css:{gap:"$lg"},children:[(0,r.jsxs)(l.kC,{direction:"column",css:{gap:"$sm"},children:[(0,r.jsxs)(l.kC,{css:{alignItems:"center",gap:"$xxxs"},children:[(0,r.jsx)(l.xv,{variant:"subline",color:"body",css:{textTransform:"uppercase"},children:"What is your Charon Client's ENR?"}),(0,r.jsx)(l.KZ,{content:"An ENR is a public key and encoded networking info starting with enr:-...",children:(0,r.jsx)(l.xu,{css:{display:"flex"},children:(0,r.jsx)(l.by,{})})})]}),(0,r.jsx)(d.iA,{control:b,name:"enr"})]}),(0,r.jsxs)(l.rU,{href:"https://docs.obol.tech/docs/start/quickstart_group#step-1-generate-an-enr",target:"_blank",children:["How to generate your ENR ",(0,r.jsx)(l.ZJ,{})]})]}),(0,r.jsxs)(l.W2,{className:"withdrawal-section",css:{gap:"$lg"},alignItems:"start",children:[(0,r.jsx)(l.xv,{variant:"h4",children:"Withdrawal Configuration"}),(0,r.jsxs)(l.mQ.Tabs,{defaultValue:X,onValueChange:e=>Z(h.RJ[e]),"aria-label":"View density",css:{width:"100%"},children:[(0,r.jsxs)(l.mQ.TabsList,{"aria-label":"Configure Withdrawal",children:[(0,r.jsx)(g.T,{name:"single_withdrawal_address_flow",children:(0,r.jsx)(l.mQ.TabsTrigger,{value:"single",disabled:!(0,g.c)("single_withdrawal_address_flow"),children:"Default"})}),(0,r.jsx)(g.T,{name:"reward_split_withdrawal_flow",children:(0,r.jsx)(l.mQ.TabsTrigger,{value:"reward_splitter",disabled:!(0,g.c)("reward_split_withdrawal_flow"),children:"Split Only Rewards"})}),(0,r.jsx)(g.T,{name:"split_withdrawal_flow",children:(0,r.jsx)(l.mQ.TabsTrigger,{value:"splitter",disabled:!(0,g.c)("split_withdrawal_flow"),children:"Split Everything"})})]}),(0,r.jsx)(l.mQ.TabsContent,{value:"single",children:(0,r.jsxs)(l.kC,{direction:"column",css:{gap:"$md",pt:"$sm"},children:[(0,r.jsx)(m.AN,{control:b,trigger:$,errors:A,handleOnSetAddress:e=>{e.preventDefault(),k("singleAddress",L),$("singleAddress")},heading:"Withdrawal Address",description:"Address to receive skimming rewards and validator principal at exit.",fieldName:"singleAddress",className:"single-address-section"}),(0,r.jsx)(m.AN,{control:b,trigger:$,errors:A,handleOnSetAddress:e=>{e.preventDefault(),k("feeRecipientAddress",L),$("feeRecipientAddress")},heading:"Fee Recipient",description:"Enter the Fee Recipient Address to receive MEV rewards (if enabled), block proposal and priority fees.",fieldName:"feeRecipientAddress",className:"fee-recipient-address-section"})]})}),(0,r.jsx)(l.mQ.TabsContent,{value:"reward_splitter",children:(0,r.jsxs)(l.kC,{direction:"column",css:{gap:"$md",pt:"$sm"},children:[(0,r.jsx)(m.AN,{control:b,trigger:$,errors:A,handleOnSetAddress:e=>{e.preventDefault(),k("principal",L),$("principal")},heading:"Principal Recipient",description:"Address that will reclaim validator principal after exit.",fieldName:"principal",className:"splitter-principal-section"}),(0,r.jsxs)(l.kC,{direction:"column",className:"splitter-reward-recipients-section",css:{gap:"$xs"},children:[(0,r.jsx)(l.xv,{variant:"h5",children:"Rewards Split"}),(0,r.jsxs)(l.kC,{css:{justifyContent:"space-between"},direction:"column",children:[(0,r.jsx)(l.xv,{color:"body",variant:"body",css:{mb:"$lg"},children:"Enter each recipients address and their share. Ownership must add to 100%."}),(0,r.jsx)(l.xv,{color:"body",variant:"body",children:"By default, a contribution is allocated to be used by Obol for Public Goods."})]}),(0,r.jsx)(m.Cl,{columns:(0,u.TV)("Rewards"),rows:z,onAddRow:handleOnAddRecipientRow,onRemoveRow:handleOnRemoveRecipient,totalSplitFooter:F,setMaxSplit:G,control:b,trigger:$,recipients:T().recipients}),(null===(i=A.recipients)||void 0===i?void 0:i.some(e=>{var s;return null==e?void 0:null===(s=e.address)||void 0===s?void 0:s.message}))&&(0,r.jsx)(l.xv,{variant:"metadata",color:"test",children:u.gv}),(null===(x=A.recipients)||void 0===x?void 0:x.some(e=>{var s;return null==e?void 0:null===(s=e.split)||void 0===s?void 0:s.message}))&&(0,r.jsx)(l.xv,{variant:"metadata",color:"test",children:"Split value should be greater than 0%"})]})," "]})}),(0,r.jsx)(l.mQ.TabsContent,{value:"splitter",children:(0,r.jsxs)(l.kC,{direction:"column",css:{gap:"$md",pt:"$sm"},children:[(0,r.jsxs)(l.kC,{direction:"column",className:"splitter-reward-recipients-section",css:{gap:"$xs"},children:[(0,r.jsx)(l.xv,{variant:"h5",children:"Principal & Rewards Split"}),(0,r.jsxs)(l.kC,{css:{justifyContent:"space-between"},direction:"column",children:[(0,r.jsx)(l.xv,{color:"body",variant:"body",css:{mb:"$lg"},children:"Enter each recipients address and their share. Ownership must add to 100%."}),(0,r.jsx)(l.xv,{color:"body",variant:"body",children:"By default, a contribution is allocated to be used by Obol for Public Goods."})]}),(0,r.jsx)(m.Cl,{columns:(0,u.TV)("Principal & Rewards"),rows:z,onAddRow:handleOnAddRecipientRow,onRemoveRow:handleOnRemoveRecipient,totalSplitFooter:F,setMaxSplit:G,control:b,trigger:$,validatorsSize:M,recipients:T().recipients}),(null===(w=A.recipients)||void 0===w?void 0:w.some(e=>{var s;return null==e?void 0:null===(s=e.address)||void 0===s?void 0:s.message}))&&(0,r.jsx)(l.xv,{variant:"metadata",color:"test",children:u.gv}),(null===(f=A.recipients)||void 0===f?void 0:f.some(e=>{var s;return null==e?void 0:null===(s=e.split)||void 0===s?void 0:s.message}))&&(0,r.jsx)(l.xv,{variant:"metadata",color:"test",children:"Split value should be greater than 0%"})]})," "]})})]})]}),(0,r.jsx)(l.kC,{direction:"column",children:(0,r.jsx)(l.zx,{color:"primary",type:"submit",disabled:!R||!y||!L||100!==F,children:"Create Cluster Configuration"})})]})})]})};s.default=ConfigCluster,ConfigCluster.layout="ProgressTrackerLayout"}},function(e){e.O(0,[774,888,179],function(){return e(e.s=62367)}),_N_E=e.O()}]);